/*! bitbucket-widget - v0.0.1 - 2012-11-19
* Copyright (c) 2012 Adam Ahmed; Licensed MIT */
(function(e,t){function n(t){var n=e(this).addClass("bitbucket-widget");if(n.data("bitbucket-repo-inited"))return;n.data("bitbucket-repo-inited",!0);var r=t&&t.author&&t.repo?t.author+"/"+t.repo:n.attr("data-repo");if(!r)throw new Error("Either a data-repo attribute or author and repo options are required.");var i=r.split("/");if(i.length!==2)throw new Error("data-repo attribute must be in 'username/repository' format.");var s=i[0],o=i[1];n.html('<div class="repo-header"><div class="repo-stats"></div><span class="repo-name"><a href=""></a> / <a href=""></a></span> <span class="repo-last-update"></span></div><div class="repo-body"></div>');var u=e(":first-child",n);u.children(".repo-name").children(":first-child").attr("href","http://www.bitbucket.org/"+s).text(s).end().children().eq(1).attr("href","http://www.bitbucket.org/"+r).text(o),e.ajax({dataType:"jsonp",url:"https://api.bitbucket.org/1.0/repositories/"+r}).done(function(t){function o(e,t,n){return e===1?t:n}var r=u.children(".repo-last-update");r.text(t.last_updated?"Last updated on "+t.last_updated:"Never updated"),t.logo&&e('<img class="repo-logo" src="'+t.logo+'" />').insertBefore(r);var i=t.forks_count||0,s=t.followers_count||0;u.children(".repo-stats").html('<div class="repo-forks" title="Has '+i+o(i," fork."," forks.")+'">'+i+"</div>"+'<div class="repo-followers" title="Has '+s+o(s," follower."," followers.")+'">'+s+"</div>");var a="";t.website&&(a+='<a class="repo-website" href="'+t.website+'">'+t.website+"</a>"),t.description&&(a+='<div class="repo-description">'+t.description.replace(/\n/g,"<br/>")+"</div>"),n.children(".repo-body").html(a),n.trigger("repo-retrieved")}).fail(function(){var e="http://bitbucket.org/"+r;n.children(".repo-body").html('<div class="error">There was error getting this repository\'s info. Try visiting <a href="'+e+'">'+e+"</a></div>")})}e.fn.bitbucketRepo=function(e){return this.each(function(){n.call(this,e)}),this},e.fn.bitbucketRepo.loadOnDocumentReady=!0,e(document).ready(function(){(t.setImmediate||t.setTimeout)(function(){if(!e.fn.bitbucketRepo.loadOnDocumentReady)return;e(".bitbucket-widget").bitbucketRepo()})})})(jQuery,this);